<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Usuario.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">G07-EsiMedia-PI-User-Backend</a> &gt; <a href="index.source.html" class="el_package">com.esimedia.features.auth.entity</a> &gt; <span class="el_source">Usuario.java</span></div><h1>Usuario.java</h1><pre class="source lang-java linenums">package com.esimedia.features.auth.entity;

import java.util.ArrayList;
import java.util.List;
import java.util.Date;


import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.index.Indexed;
import org.springframework.data.mongodb.core.mapping.Document;
import org.springframework.data.mongodb.core.mapping.Field;

import com.esimedia.features.auth.enums.Rol;

import jakarta.validation.constraints.*;
import lombok.AccessLevel;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import lombok.experimental.SuperBuilder;

<span class="pc bpc" id="L22" title="32 of 128 branches missed.">@Data</span>
<span class="fc" id="L23">@NoArgsConstructor(access = AccessLevel.PUBLIC)</span>
<span class="pc bpc" id="L24" title="3 of 8 branches missed.">@SuperBuilder</span>
@Document(collection = &quot;usuarios&quot;)
public class Usuario {
    
    @Id
<span class="fc" id="L29">    private String idUsuario;</span>

    @Field(&quot;nombre&quot;)
    @NotBlank(message = &quot;El nombre no puede estar vacío&quot;)
    @Size(min = 2, max = 50, message = &quot;El nombre debe tener entre 2 y 50 caracteres&quot;)
    @Pattern(regexp = &quot;^[\\p{L}\\s'-]{2,}$&quot;, message = &quot;El nombre contiene caracteres inválidos&quot;)
<span class="fc" id="L35">    private String nombre;</span>

    @Field(&quot;apellidos&quot;)
    @NotBlank(message = &quot;Los apellidos no pueden estar vacíos&quot;)
    @Size(min = 2, max = 100, message = &quot;Los apellidos deben tener entre 2 y 100 caracteres&quot;)
    @Pattern(regexp = &quot;^[\\p{L}\\s'-]{2,}$&quot;, message = &quot;Los apellidos contienen caracteres inválidos&quot;)
<span class="fc" id="L41">    private String apellidos;</span>

    @Indexed(unique = true)
    @Field(&quot;email&quot;)
    @NotBlank(message = &quot;El email no puede estar vacío&quot;)
    @Email(message = &quot;El formato del email no es válido&quot;)
    @Size(max = 254, message = &quot;El email no puede exceder 254 caracteres&quot;)
<span class="fc" id="L48">    private String email;</span>

    @Field(&quot;alias&quot;)
    @Size(min = 3, max = 12, message = &quot;El alias debe tener entre 3 y 12 caracteres&quot;)
    @Pattern(regexp = &quot;^[a-zA-Z][a-zA-Z\\d_-]{2,}$&quot;, message = &quot;El alias debe comenzar con una letra&quot;)
<span class="fc" id="L53">    private String alias;</span>

    @Field(&quot;password&quot;)
    @NotBlank(message = &quot;La contraseña no puede estar vacía&quot;)
    @Size(min = 8, max = 128, message = &quot;La contraseña debe tener entre 8 y 128 caracteres&quot;)
<span class="fc" id="L58">    private String password;</span>

    @Field(&quot;passwordHistory&quot;)
    @Builder.Default
<span class="fc" id="L62">    private List&lt;String&gt; passwordHistory = new ArrayList&lt;&gt;();</span>

    @Field(&quot;passwordChangedAt&quot;)
<span class="fc" id="L65">    private java.time.LocalDateTime passwordChangedAt;</span>

    @Field(&quot;fotoPerfil&quot;)
<span class="fc" id="L68">    protected String fotoPerfil;</span>

    @Field(&quot;fechaRegistro&quot;)
    @NotNull(message = &quot;La fecha de registro no puede ser nula&quot;)
    @PastOrPresent(message = &quot;La fecha de registro no puede ser futura&quot;)
<span class="fc" id="L73">    private Date fechaRegistro;</span>

    @Field(&quot;credentialsVersion&quot;)
    @Min(value = 1, message = &quot;La versión de credenciales debe ser al menos 1&quot;)
<span class="fc" id="L77">    private long credentialsVersion;</span>

    @Field(&quot;twoFactorEnabled&quot;)
    @Builder.Default
<span class="fc" id="L81">    private boolean twoFactorEnabled = false;</span>
    
    @Field(&quot;thirdFactorEnabled&quot;)
    @Builder.Default
<span class="fc" id="L85">    private boolean thirdFactorEnabled = false;</span>
    
    @Field(&quot;totpSecret&quot;)
    @Size(max = 50, message = &quot;El secreto TOTP no puede exceder 50 caracteres&quot;)
<span class="fc" id="L89">    private String totpSecret;</span>
    
    @Field(&quot;backupCodes&quot;)
    @Size(max = 10, message = &quot;No puede tener más de 10 códigos de respaldo&quot;)
<span class="fc" id="L93">    private List&lt;String&gt; backupCodes;</span>
    
    @NotNull(message = &quot;El rol no puede ser nulo&quot;)
<span class="fc" id="L96">    private Rol rol;</span>

    @Field(&quot;gustosTags&quot;)
    @Builder.Default
<span class="fc" id="L100">    private java.util.List&lt;String&gt; gustosTags = new ArrayList&lt;&gt;();</span>



    // Constructor para uso en createUser (sin validaciones - ahora se valida en ValidationService)
<span class="fc" id="L105">    public Usuario(String nombre, String apellidos, String email, String alias, String password, Rol rol) {</span>
<span class="fc" id="L106">        this.nombre = nombre;</span>
<span class="fc" id="L107">        this.apellidos = apellidos;</span>
<span class="fc" id="L108">        this.email = email;</span>
<span class="fc" id="L109">        this.alias = alias;</span>
<span class="fc" id="L110">        this.password = password;</span>
<span class="fc" id="L111">        this.passwordHistory = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L112">        this.passwordChangedAt = null;</span>
<span class="fc" id="L113">        this.rol = rol;</span>
<span class="fc" id="L114">        this.fechaRegistro = new Date();</span>
<span class="fc" id="L115">        this.credentialsVersion = 1L;</span>
<span class="fc" id="L116">        this.gustosTags = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L118">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>