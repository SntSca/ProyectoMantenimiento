<!-- Modal de cambiar contraseÃ±a -->
<div class="modal-overlay" *ngIf="visible" (click)="cancelChange.emit()" (keydown)="onModalKeyDown($event)">
  <div class="modal-card" (click)="$event.stopPropagation()" (keydown)="onModalKeyDown($event)">
    <header class="app-header compact minimal" [ngClass]="variant">
      <div class="header-content">
        <h3 class="header-title">{{ title }}</h3>
      </div>
    </header>
    <div class="modal-body">
      <form [formGroup]="passwordForm" class="login-form">
        <div class="form-group" *ngIf="passwordForm.get('currentPassword')">
          <label for="current-password" class="form-label">ContraseÃ±a Actual <span class="required">*</span></label>
          <div class="input-wrapper">
            <input
              type="{{ showCurrentPassword ? 'text' : 'password' }}"
              id="current-password"
              class="form-input"
              formControlName="currentPassword"
              [class.input-error]="isFieldInvalid('currentPassword')"
              placeholder="Introduce tu contraseÃ±a actual">
            <button type="button" class="toggle-password" (click)="togglePassword('currentPassword')">
              <span class="eye-icon">{{ showCurrentPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</span>
            </button>
          </div>
          <div class="error-message" *ngIf="isFieldInvalid('currentPassword')">
            {{ getFieldError('currentPassword') }}
          </div>
        </div>

        <div class="form-group">
          <label for="new-password" class="form-label">Nueva ContraseÃ±a <span class="required">*</span></label>
          <div class="input-wrapper">
            <input
              type="{{ showNewPassword ? 'text' : 'password' }}"
              id="new-password"
              class="form-input"
              formControlName="newPassword"
              [class.input-error]="isFieldInvalid('newPassword')"
              placeholder="Introduce la nueva contraseÃ±a">
            <button type="button" class="toggle-password" (click)="togglePassword('newPassword')">
              <span class="eye-icon">{{ showNewPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</span>
            </button>
          </div>
          <div class="error-message" *ngIf="isFieldInvalid('newPassword')">
            {{ getFieldError('newPassword') }}
          </div>
          <div class="password-requirements-inline">
            <div class="requirement" *ngFor="let requirement of getPasswordRequirements()">
              - {{ requirement }}
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="confirm-password" class="form-label">Confirmar Nueva ContraseÃ±a <span class="required">*</span></label>
          <div class="input-wrapper">
            <input
              type="{{ showConfirmPassword ? 'text' : 'password' }}"
              id="confirm-password"
              class="form-input"
              formControlName="confirmPassword"
              [class.input-error]="isFieldInvalid('confirmPassword') || (passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched)"
              placeholder="Confirma la nueva contraseÃ±a">
            <button type="button" class="toggle-password" (click)="togglePassword('confirmPassword')">
              <span class="eye-icon">{{ showConfirmPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</span>
            </button>
          </div>
          <div class="error-message" *ngIf="isFieldInvalid('confirmPassword')">
            {{ getFieldError('confirmPassword') }}
          </div>
          <div class="error-message" *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched">
            Las contraseÃ±as no coinciden
          </div>
        </div>
      </form>

      <div class="modal-actions" style="padding-top: 1rem;">
        <button
          type="button"
          class="login-btn"
          [disabled]="passwordForm.invalid"
          (click)="onConfirm()">
          <span class="btn-icon">ğŸ”’</span>
          <span class="btn-text">{{ confirmButtonText }}</span>
        </button>
        <button type="button" class="login-btn secondary" (click)="cancelChange.emit()">
          <span class="btn-icon">âŒ</span>
          <span class="btn-text">Cancelar</span>
        </button>
      </div>
    </div>
  </div>
</div>
