<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ContentUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">G07-EsiMedia-PI-User-Backend</a> &gt; <a href="index.source.html" class="el_package">com.esimedia.shared.util</a> &gt; <span class="el_source">ContentUtil.java</span></div><h1>ContentUtil.java</h1><pre class="source lang-java linenums">package com.esimedia.shared.util;

import java.util.Base64;

public class ContentUtil {
    
    private static final String DATA_URI_PREFIX = &quot;data:&quot;;
    private static final String DATA_URI_BASE64_PREFIX = &quot;;base64,&quot;;
    
    // Private constructor to prevent instantiation
<span class="nc" id="L11">    private ContentUtil() {</span>
<span class="nc" id="L12">        throw new UnsupportedOperationException(&quot;Utility class&quot;);</span>
    }

    /**
     * Recibe una extensión MIME y un array de bytes, y devuelve la cadena en formato base64 tipo data:&lt;extension&gt;;base64,&lt;contenido&gt;
     */
    public static String createBase64StringFromBinary(String mimeType, byte[] bytes) {
<span class="nc bnc" id="L19" title="All 4 branches missed.">        if (mimeType == null || bytes == null) {</span>
<span class="nc" id="L20">            return null;</span>
        }
<span class="nc" id="L22">        String base64Data = Base64.getEncoder().encodeToString(bytes);</span>
<span class="nc" id="L23">        return DATA_URI_PREFIX + mimeType + DATA_URI_BASE64_PREFIX + base64Data;</span>
    }

    /**
     * Decodifica una cadena base64 pura (sin prefijos) a bytes.
     * @param base64Content Contenido base64 puro
     * @return Array de bytes decodificado
     * @throws IllegalArgumentException si el base64 no es válido
     */
    public static byte[] decodeBase64(String base64Content) {
<span class="pc bpc" id="L33" title="1 of 4 branches missed.">        if (base64Content == null || base64Content.trim().isEmpty()) {</span>
<span class="fc" id="L34">            return new byte[0];</span>
        }
        try {
<span class="fc" id="L37">            return Base64.getDecoder().decode(base64Content.trim());</span>
        } 
<span class="nc" id="L39">        catch (IllegalArgumentException e) {</span>
<span class="nc" id="L40">            throw new IllegalArgumentException(&quot;Contenido base64 inválido&quot;, e);</span>
        }
    }

    /**
     * Extrae el MIME type de un data URI.
     * @param dataUri Data URI en formato &quot;data:tipo/mime&quot; o &quot;data:tipo/mime;base64,contenido&quot;
     * @return El tipo MIME extraído, o null si no es válido
     */
    public static String extractMimeFromDataUri(String dataUri) {
<span class="nc bnc" id="L50" title="All 4 branches missed.">        if (dataUri == null || !dataUri.startsWith(DATA_URI_PREFIX)) {</span>
            // Si no es data URI, devolver como está
<span class="nc" id="L52">            return dataUri;</span>
        }
        
        // Remover &quot;data:&quot;
<span class="nc" id="L56">        String withoutPrefix = dataUri.substring(5);</span>
<span class="nc" id="L57">        int semicolonIndex = withoutPrefix.indexOf(';');</span>
        
<span class="nc bnc" id="L59" title="All 2 branches missed.">        if (semicolonIndex != -1) {</span>
<span class="nc" id="L60">            return withoutPrefix.substring(0, semicolonIndex);</span>
        } 
        else {
<span class="nc" id="L63">            return withoutPrefix;</span>
        }
    }

    /**
     * Decodifica contenido de imagen Base64 (validaciones ya hechas en DTO)
     * @param base64Content Contenido base64 puro (puede ser null para imágenes opcionales)
     * @return Array de bytes decodificado o null si no hay contenido
     */
    public static byte[] decodeImage(String base64Content) {
<span class="pc bpc" id="L73" title="2 of 4 branches missed.">        if (base64Content == null || base64Content.trim().isEmpty()) {</span>
<span class="nc" id="L74">            return new byte[0];</span>
        }
<span class="fc" id="L76">        return decodeBase64(base64Content);</span>
    }

    /**
     * Decodifica contenido de audio Base64 (validaciones ya hechas en DTO)
     * @param base64Content Contenido base64 puro (ya validado como @NotBlank en DTO)
     * @return Array de bytes decodificado
     */
    public static byte[] decodeAudio(String base64Content) {
<span class="fc" id="L85">        return decodeBase64(base64Content);</span>
    }



    /**
     * Decodifica contenido de video Base64 (validaciones ya hechas en DTO)
     * @param base64Content Contenido base64 puro (ya validado como @NotBlank en DTO)
     * @return Array de bytes decodificado
     */
    public static byte[] decodeVideo(String base64Content) {
<span class="nc" id="L96">        return decodeBase64(base64Content);</span>
    }



    /**
     * Decodifica contenido base64 con manejo específico de errores para cualquier tipo de contenido.
     * Para contenido OBLIGATORIO (ficheros de audio/video).
     * @param contentBase64 Contenido base64 puro a decodificar
     * @param contentType Tipo de contenido para mensajes de error específicos (ej: &quot;fichero de audio&quot;, &quot;miniatura&quot;, &quot;foto de perfil&quot;)
     * @return Array de bytes decodificado
     * @throws IllegalArgumentException si el base64 no es válido o está vacío
     */
    public static byte[] decodeContentBase64(String contentBase64, String contentType) {
<span class="nc bnc" id="L110" title="All 4 branches missed.">        if (contentBase64 == null || contentBase64.trim().isEmpty()) {</span>
<span class="nc" id="L111">            throw new IllegalArgumentException(&quot;El &quot; + contentType + &quot; no puede estar vacío&quot;);</span>
        }
        try {
<span class="nc" id="L114">            return Base64.getDecoder().decode(contentBase64.trim());</span>
        } 
<span class="nc" id="L116">        catch (IllegalArgumentException e) {</span>
<span class="nc" id="L117">            throw new IllegalArgumentException(contentType + &quot; no está en base64 válido&quot;, e);</span>
        }
    }

    /**
     * Convierte bytes y MIME type a data URI completo.
     * @param bytes Array de bytes del contenido (puede ser null)
     * @param mimeType Tipo MIME (ej: &quot;image/jpeg&quot;, &quot;audio/wav&quot;)
     * @return Data URI completo (ej: &quot;data:image/jpeg;base64,UklGRig...&quot;) o null si bytes es null
     */
    public static String createDataUri(byte[] bytes, String mimeType) {
<span class="pc bpc" id="L128" title="1 of 4 branches missed.">        if (bytes == null || mimeType == null) {</span>
<span class="fc" id="L129">            return null;</span>
        }
<span class="fc" id="L131">        String base64Data = Base64.getEncoder().encodeToString(bytes);</span>
<span class="fc" id="L132">        return DATA_URI_PREFIX + mimeType + DATA_URI_BASE64_PREFIX + base64Data;</span>
    }

    /**
     * Convierte Binary (MongoDB) y MIME type a data URI completo.
     * @param binary MongoDB Binary object (puede ser null)
     * @param mimeType Tipo MIME
     * @return Data URI completo o null si binary es null
     */
    public static String createDataUriFromBinary(byte[] binary, String mimeType) {
<span class="fc" id="L142">        return createDataUri(binary, mimeType);</span>
    }

    /**
     * Valida que una cadena sea base64 válido.
     * @param base64Content Contenido a validar
     * @return true si es base64 válido, false en caso contrario
     */
    public static boolean isValidBase64(String base64Content) {
<span class="pc bpc" id="L151" title="2 of 4 branches missed.">        if (base64Content == null || base64Content.trim().isEmpty()) {</span>
<span class="nc" id="L152">            return false;</span>
        }
        try {
<span class="fc" id="L155">            Base64.getDecoder().decode(base64Content.trim());</span>
<span class="fc" id="L156">            return true;</span>
        } 
<span class="nc" id="L158">        catch (IllegalArgumentException e) {</span>
<span class="nc" id="L159">            return false;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>