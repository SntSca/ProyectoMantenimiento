<div class="dashboard-container usuario-variant">
  
  <!-- Menu Lateral Izquierdo -->
  <aside class="sidebar-menu">
    <!-- Perfil -->
    <div class="user-profile-container">
      <button type="button" class="user-profile" [routerLink]="USUARIO_ROUTES.perfil">
        <div class="avatar-container">
          <img src="{{ actualUser.fotoPerfil || 'assets/porDefecto.jpg' }}" alt="Avatar del usuario" class="user-avatar">
        </div>
        <div class="user-info">
          <h3 class="user-name">{{ actualUser.nombre }} {{ actualUser.primerApellido }}</h3>
          <p class="profile-hint">ğŸ‘¤ Ver perfil</p>
        </div>
      </button>
    </div>

    <!-- NavegaciÃ³n principal -->
    <nav class="menu-navigation">
      <ul class="menu-list">
        <li class="menu-item" [class.active]="isMenuSectionActive('notificaciones')">
          <button type="button" class="menu-button notification-btn" (click)="openNotificationsModal()">
            <div class="menu-text">
              <span class="menu-icon">ğŸ””</span>
              <span>Notificaciones</span>
              <span class="badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
            </div>
          </button>
        </li>
        
        <li class="menu-item" [class.active]="isMenuSectionActive('inicio')">
          <button type="button" class="menu-button" (click)="setActiveMenuSection('inicio')">
            <div class="menu-text">
              <span class="menu-icon">ğŸ </span>
              <span>Inicio</span>
            </div>
          </button>
        </li>

        <!-- Otros botones -->
        <li class="menu-item" [class.active]="isMenuSectionActive('listas-publicas')">
          <button type="button" class="menu-button" (click)="setActiveMenuSection('listas-publicas')">
            <div class="menu-text">
              <span class="menu-icon">ğŸŒ</span>
              <span>Listas PÃºblicas</span>
            </div>
          </button>
        </li>

        <li class="menu-item">
          <button type="button" class="menu-button" [routerLink]="USUARIO_ROUTES.listas" [queryParams]="{ tipo: 'privadas' }">
            <div class="menu-text">
              <span class="menu-icon">ğŸ“‹</span>
              <span>Mis Listas</span>
            </div>
          </button>
        </li>
        <!-- Favoritos y demÃ¡s -->
        <li class="menu-item" [class.active]="isMenuSectionActive('favoritos')">
          <button type="button" class="menu-button" (click)="loadFavorites()">
            <div class="menu-text">
              <span class="menu-icon">â­</span>
              <span>Favoritos</span>
            </div>
          </button>
        </li>
      </ul>

      <div class="menu-divider"></div>

      <ul class="menu-list">
        <li class="menu-item logout">
          <button (click)="logout()" class="logout-button">
            <div class="menu-text">
              <span class="menu-icon">ğŸšª</span>
              <span>Cerrar SesiÃ³n</span>
            </div>
          </button>
        </li>
      </ul>
    </nav>
  </aside>




  <!-- Contenido Principal -->
  <main class="main-content">
    <!-- Barra de BÃºsqueda y Filtros -->
    <header class="search-header">
      <div class="search-container">
        <div class="search-bar">
          <input 
            type="text" 
            placeholder="Buscar videos, creadores, tags..." 
            [(ngModel)]="searchTermValue"
            class="search-input">
          <button class="search-button">
            <span class="search-icon">ğŸ”</span>
          </button>
        </div>
      </div>

    <!-- BotÃ³n para cambiar vista -->
      <div class="view-toggle">
        <button 
          type="button" 
          class="view-toggle-btn" 
          (click)="filtrarPorTipoContenidoContenidos(isTipoContenidoContenidos === null ? 'AUDIO' : isTipoContenidoContenidos === true ? 'VIDEO' : null); isTipoContenidoContenidos = isTipoContenidoContenidos === null ? true : isTipoContenidoContenidos === true ? false : null"
          [attr.aria-label]="isTipoContenidoContenidos === null ? 'Filtrar por audio' : isTipoContenidoContenidos === true ? 'Filtrar por video' : 'Mostrar todos'">
          <span class="view-icon">{{ isTipoContenidoContenidos === null ? 'ğŸ¬' : isTipoContenidoContenidos === true ? 'ğŸ§' : 'ğŸ¥' }}</span>
          <span class="view-text">{{ isTipoContenidoContenidos === null ? 'Contenido' : isTipoContenidoContenidos === true ? 'Audio' : 'Video' }}</span>
        </button>
        <button 
          type="button" 
          class="view-toggle-btn" 
          (click)="toggleRestriccionEdad()"
          [attr.aria-label]="filtroRestriccionEdad === null ? 'Sin filtro de edad' : 'MÃ¡ximo +' + filtroRestriccionEdad">
          <span class="view-icon">ğŸ¯</span>
          <span class="view-text">{{ filtroRestriccionEdad === null ? 'Edad' : '+' + filtroRestriccionEdad }}</span>
        </button>
        <button 
          type="button" 
          class="view-toggle-btn reset-btn" 
          (click)="restablecerFiltros()"
          [attr.aria-label]="'Restablecer todos los filtros'">
          <span class="view-icon">ğŸ”„</span>
          <span class="view-text">Restablecer</span>
        </button>
        <button 
          type="button" 
          class="view-toggle-btn" 
          (click)="toggleView()"
          [attr.aria-label]="isListView ? 'Cambiar a vista de cuadrÃ­cula' : 'Cambiar a vista de lista'">
          <span class="view-icon">{{ isListView ? 'âŠ' : 'â˜°' }}</span>
          <span class="view-text">{{ isListView ? 'CuadrÃ­cula' : 'Lista' }}</span>
        </button>
      </div>
    </header>

    <!-- Filtros de Tags -->
    <section class="filters-section">
      <button 
        type="button"
        class="filters-toggle-btn"
        (click)="toggleTagFilters()">
        <span class="toggle-icon">{{ showTagFilters ? 'â–¼' : 'â–¶' }}</span>
        <span class="toggle-text">Filtros por Tags</span>
        <span class="filter-count" *ngIf="filtroTagsContenidos.length > 0">({{ filtroTagsContenidos.length }})</span>
      </button>
      
      <div class="filters-container" [class.expanded]="showTagFilters">
        <button 
          class="filters-btn clear-btn"
          *ngIf="filtroTagsContenidos.length > 0"
          (click)="limpiarFiltrosTags()">
          âœ• Limpiar filtros
        </button>
        <button *ngFor="let tag of tags; let i = index" 
          class="filters-btn" 
          [class.active]="isTagActive(tag.nombre)"
          (click)="filtrarPorTags(tag.nombre)">
          {{ tag.nombre }}
        </button>
      </div>
    </section>


    <!-- Contenido - Vista Grid -->
    <div *ngIf="!isListView" class="content-grid">
      <div *ngFor="let contenido of contenidosFiltrados" class="content-card" [class.favorites-mode]="showingFavorites" (click)="verContenido(contenido)" (keydown.enter)="verContenido(contenido)">
        <div class="card-thumbnail">
          <img [src]="contenido.miniatura" [alt]="contenido.titulo" class="thumbnail-image">
          <span class="video-duration">{{ contenido.duracionFormateada }}</span>
          <div class="content-badges">
            <span class="badge vip" *ngIf="contenido.esVIP">ğŸ‘‘ VIP</span>
            <span class="badge type">{{ contenido.tipo === 'VIDEO' ? 'ğŸ¥' : 'ğŸ§' }}</span>
            <span class="badge age age-{{ contenido.restriccionEdad }}">+{{ contenido.restriccionEdad }}</span>
          </div>
          <!-- BotÃ³n de eliminar favoritos -->
          <button 
            *ngIf="showingFavorites" 
            class="remove-favorite-btn" 
            (click)="removeFavorite($event, contenido)"
            [attr.aria-label]="'Eliminar ' + contenido.titulo + ' de favoritos'">
            âœ•
          </button>
        </div>
        <div class="card-info">
          <div class="title-row">
            <h3 class="card-title">{{ contenido.titulo }}</h3>
          </div>
          <div class="card-category-rating">
            <div class="card-category">{{ contenido.especialidad }}</div>
            <div class="stars">
              <span *ngFor="let star of getStarsArray(contenido.valoracionMedia || 0)" class="star">
                {{ star === 1 ? 'â˜…' : star === 0.5 ? 'â¯ª' : 'â˜†' }}
              </span>
              <span class="rating-number">({{ (contenido.valoracionMedia || 0) | number:'1.1-1' }})</span>
            </div>
          </div>
          <div class="card-tags">{{ contenido.tags.join(', ') }}</div>
          <div class="card-stats">
            <span class="stat-item">â° {{ contenido.fechaExpiracion ? (contenido.fechaExpiracion | date:'dd/MM/yyyy') : 'Sin expiraciÃ³n' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Contenido - Vista Lista -->
    <div *ngIf="isListView" class="list-view">
      <ul class="content-list">
        <li *ngFor="let contenido of contenidosFiltrados" class="list-item" [class.favorites-mode]="showingFavorites" (click)="verContenido(contenido)" (keydown.enter)="verContenido(contenido)">
          <div class="list-thumbnail">
            <img [src]="contenido.miniatura" [alt]="contenido.titulo">
            <!-- BotÃ³n de eliminar favoritos -->
            <button 
              *ngIf="showingFavorites" 
              class="remove-favorite-btn" 
              (click)="removeFavorite($event, contenido)"
              [attr.aria-label]="'Eliminar ' + contenido.titulo + ' de favoritos'">
              âœ•
            </button>
          </div>
          <div class="list-content">
            <div class="list-title-container">
              <h3 class="list-title">{{ contenido.titulo }}</h3>
              <div class="stars">
                <span *ngFor="let star of getStarsArray(contenido.valoracionMedia)" class="star">
                  {{ star === 1 ? 'â˜…' : star === 0.5 ? 'â¯ª' : 'â˜†' }}
                </span>
                <span class="rating-number">({{ (contenido.valoracionMedia || 0) | number:'1.1-1' }})</span>
              </div>
            </div>
            <div class="list-specialty-tags">
              ğŸ·ï¸ {{ contenido.especialidad }} - ğŸ“ {{ contenido.tags.join(', ') }}
            </div>
            <div class="list-details">
              {{ contenido.tipo === 'VIDEO' ? 'ğŸ¥' : 'ğŸ§' }} {{ contenido.tipo }} - â±ï¸ {{ contenido.duracionFormateada }} - â° Expira: {{ contenido.fechaExpiracion ? (contenido.fechaExpiracion | date:'dd/MM/yyyy') : 'Sin expiraciÃ³n' }} - ğŸ¯ +{{ contenido.restriccionEdad }} - {{ contenido.esVIP ? 'ğŸ‘‘ VIP' : 'EstÃ¡ndar' }}
            </div>
          </div>
        </li>
      </ul>
      
      <!-- Estado vacÃ­o para lista -->
      <div *ngIf="contenidosFiltrados.length === 0" class="list-empty-state">
        <div class="empty-icon">ğŸ“¹</div>
        <h3 class="empty-title">No se encontraron contenidos</h3>
        <p class="empty-message">Intenta cambiar los filtros de bÃºsqueda o verifica tu conexiÃ³n.</p>
      </div>
    </div>


